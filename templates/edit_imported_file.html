{% extends "templates/base.html" %}

{% block content %}
  <style>
    .add_schema_input {
      width: 500px;
    }
    .preview_table {
      border-collapse: collapse;
    }
    .preview_table td {
      border: 1px solid #eee;
      padding: 3px;
    }
    .preview_table tr:first-of-type {
      font-weight: bold;
    }

    table.imported_transactions {
      table-layout: fixed;
    }
    .imported_transaction td {
      height: 20px;
      border-top: 1px solid #eee;
      vertical-align: top;
      padding: 0 5px;
    }
    .imported_transaction .date_cell {
      color: #999;
      width: 100px;
    }
    .imported_transaction .description_cell {
      width: 400px;
    }
    .imported_transaction .amount_cell.credit {
      color: #008000;
    }
    .imported_transaction .amount_cell.debit {
      color: #800000;
    }
  </style>

  <div>
    <p>Date: {{ imported_file.date }}</p>

    {% if not imported_file.parsed %}
      <p>
        Select schema:
        <form action="/do/apply_parse_schema_to_import_file" method="post">
          <input type="hidden" name="id" value="{{ imported_file.key.id() }}">
          <select name="schema">
            {% for schema in profile.parse_schemas %}
              {% if schema.schema == imported_file.schema %}
                {% set selected = "selected" %}
              {% else %}
                {% set selected = "" %}
              {% endif %}
              <option value="{{ schema.schema }}" {{ selected }}>
                {{ schema.name }}
              </option>
            {% endfor %}
          </select>
          <input type="submit" value="Apply">
        </form>
        <form action="/do/add_parse_schema" method="post">
          Add new schema:<br>
          <label>
            Name:
            <input name="name"/>
          </label>
          <label>
            Schema:
            <input name="schema" class="add_schema_input"/>
          </label>
          <input type="submit" value="Add">
        </form>
      <p>
      Header:
      <table class="preview_table" cellpadding="0" cellspacing="0">
        {% for line in formatted_parsed_lines %}
          <tr>
            {% for cell in line %}
              <td>{{ cell }}</td>
            {% endfor %}
          </tr>
        {% endfor %}
      </table>
      <form action="/do/mark_import_file_as_parsed" method="post">
        <input type="hidden" name="id" value="{{ imported_file.key.id() }}">
        <input type="submit" value="Parse">
      </form>
    {% else %}

      <table class="imported_transactions" cellpadding="0" cellspacing="0">
        {% for transaction in imported_file.parsed_transactions %}
          <tr class="imported_transaction">
            <td class="date_cell">
              {{ transaction.date.strftime('%a, %d %b') }}
            </td>
            <td class="description_cell">
              {{ transaction.description }}
            </td>
            {% if transaction.amount < 0 %}
              <td class="amount_cell credit">{{ transaction.amount|abs }}</td>
            {% else %}
              <td class="amount_cell debit">{{ transaction.amount }}</td>
            {% endif %}
          </tr>
        {% endfor %}
      </table>

    {% endif %}
  </div>
{% endblock %}
