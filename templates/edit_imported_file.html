{% extends "templates/base.html" %}

{% block content %}
  <style>
    .add_schema_input {
      width: 500px;
    }
    .preview_table {
      border-collapse: collapse;
    }
    .preview_table td {
      border: 1px solid #eee;
      padding: 3px;
    }
    .preview_table tr:first-of-type {
      font-weight: bold;
    }
  </style>

  <div>
    <p>Date: {{ imported_file.date }}</p>
    {% if not imported_file.parsed %}
      <p>
        Select schema:
        <form action="/do/apply_parse_schema_to_import_file" method="post">
          <input type="hidden" name="id" value="{{ imported_file.key.id() }}">
          <select name="schema">
            {% for schema in profile.parse_schemas %}
              {% if schema.schema == imported_file.schema %}
                {% set selected = "selected" %}
              {% else %}
                {% set selected = "" %}
              {% endif %}
              <option value="{{ schema.schema }}" {{ selected }}>
                {{ schema.name }}
              </option>
            {% endfor %}
          </select>
          <input type="submit" value="Apply">
        </form>
        <form action="/do/add_parse_schema" method="post">
          Add new schema:<br>
          <label>
            Name:
            <input name="name"/>
          </label>
          <label>
            Schema:
            <input name="schema" class="add_schema_input"/>
          </label>
          <input type="submit" value="Add">
        </form>
      <p>
      Header:
      <table class="preview_table" cellpadding="0" cellspacing="0">
        {% for line in formatted_parsed_lines %}
          <tr>
            {% for cell in line %}
              <td>{{ cell }}</td>
            {% endfor %}
          </tr>
        {% endfor %}
      </table>
      <form action="/do/mark_import_file_as_parsed" method="post">
        <input type="hidden" name="id" value="{{ imported_file.key.id() }}">
        <input type="submit" value="Parse">
      </form>
    {% endif %}
  </div>
{% endblock %}
